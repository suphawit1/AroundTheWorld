{% extends 'app_general/components/base.html'%}
{% block content%}
    <form method="post">
        <h1>Payment - Card</h1>
        {% csrf_token %}
        {{ form.as_p }}
        <p>{{book.BookTime}}</p>
        <p>
            <button type = "submit">จ่าย</button>
        </p>
        <p>โปรดชำระภายใน</p><div id="countdown"></div>
    </form>


<script>
    // Set the target date and time for the countdown (assuming booktime is correctly parsed)
    var inputDateStr = "{{book.BookTime}}";

    // Define a mapping for Thai month names to English month names
    var thaiMonthMap = {
    "มกราคม": "01",
    "กุมภาพันธ์": "02",
    "มีนาคม": "03",
    "เมษายน": "04",
    "พฤษภาคม": "05",
    "มิถุนายน": "06",
    "กรกฎาคม": "07",
    "สิงหาคม": "08",
    "กันยายน": "09",
    "ตุลาคม": "10",
    "พฤศจิกายน": "11",
    "ธันวาคม": "12"
    };

    // Split the input string into date and time parts
    var parts = inputDateStr.split(", ");

    // Extract the Thai month name
    var thaiMonth = parts[0].split(" ")[1];

    // Map the Thai month name to the English month name
    var englishMonth = thaiMonthMap[thaiMonth];

    // Extract the day and year
    var dayAndYear = parts[0].split(" ");
    var day = parseInt(dayAndYear[0]);
    var year = parseInt(dayAndYear[2]);

    // Extract the time
    var time = parts[1];

    // Create a formatted date string in English format
    var formattedDateStr = year+ "-" +englishMonth + "-" + day + "T" + time+"Z";

    // Create a JavaScript Date object from the formatted date string
    var formattedDate = new Date(formattedDateStr);

    
    // Set the target date and time for the countdown (assuming booktime is correctly parsed)
    var booktime = new Date(formattedDateStr).getTime();
    var oneDayMilliseconds = 24 * 60 * 60 * 1000;
    var targetDate = booktime + oneDayMilliseconds;

    // Update the countdown every second
    var countdown = setInterval(function() {
        var currentDate = new Date().getTime();
        var timeLeft = targetDate - currentDate;

        // Calculate days, hours, minutes, and seconds
        var days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
        var hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

        // Display the countdown on your HTML element
        document.getElementById("countdown").innerHTML = hours + "ชม. " + minutes + "น. " + seconds + "วิ ";

        // If the countdown reaches zero, do something (e.g., show a message)
        if (timeLeft < 0) {
            clearInterval(countdown);
            document.getElementById("countdown").innerHTML = "Countdown expired!";
        }
    }, 1000); // Update every 1 second (1000 milliseconds)
</script>
{% endblock content%}